# üöÄ Daemon Mode Guide - –ü—Ä–æ—Å—Ç–æ–π —Ñ–æ–Ω–æ–≤—ã–π –∑–∞–ø—É—Å–∫

## –û–±–∑–æ—Ä

Telegram Bot Manager –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç **–∏—Å—Ç–∏–Ω–Ω—ã–π Unix daemon —Ä–µ–∂–∏–º**, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å –ø—Ä–æ–µ–∫—Ç –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ —Å –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏.

## üéØ –í —á–µ–º —Ä–∞–∑–Ω–∏—Ü–∞ –æ—Ç systemd?

| –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å | Daemon Mode (`--daemon`) | Systemd Service |
|-------------|--------------------------|-----------------|
| **–ü—Ä–æ—Å—Ç–æ—Ç–∞** | –û–¥–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ | –¢—Ä–µ–±—É–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏ |
| **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ** | PID —Ñ–∞–π–ª—ã | systemctl –∫–æ–º–∞–Ω–¥—ã |
| **–ê–≤—Ç–æ–∑–∞–ø—É—Å–∫** | –ù–µ—Ç | –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–∏—Å—Ç–µ–º—ã |
| **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** | –ë–∞–∑–æ–≤—ã–π | –ü–æ–ª–Ω—ã–π (journald) |
| **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ** | –í—Ä–µ–º–µ–Ω–Ω—ã–π –∑–∞–ø—É—Å–∫ | –ü–æ—Å—Ç–æ—è–Ω–Ω–∞—è —Å–ª—É–∂–±–∞ |

## ‚ö° –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ó–∞–ø—É—Å–∫ –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ:
```bash
python3 start.py --daemon
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞:
```bash
python3 start.py --status
```

### –û—Å—Ç–∞–Ω–æ–≤–∫–∞:
```bash
python3 start.py --stop
```

## üìã –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ

### 1. –ó–∞–ø—É—Å–∫ daemon
```bash
# –ü–æ–ª–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞
python3 start.py --daemon

# –ö–æ—Ä–æ—Ç–∫–∞—è –≤–µ—Ä—Å–∏—è
python3 start.py -d
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —á—Ç–æ daemon –Ω–µ –∑–∞–ø—É—â–µ–Ω
- ‚úÖ –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ  
- ‚úÖ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- ‚úÖ –ü—Ä–æ—Ü–µ—Å—Å –æ—Ç–∫–ª—é—á–∞–µ—Ç—Å—è –æ—Ç —Ç–µ—Ä–º–∏–Ω–∞–ª–∞
- ‚úÖ –°–æ–∑–¥–∞–µ—Ç—Å—è PID —Ñ–∞–π–ª –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- ‚úÖ –ù–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è signal handlers
- ‚úÖ –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è Flask –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
```bash
python3 start.py --status
```

**–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç:**
- PID –ø—Ä–æ—Ü–µ—Å—Å–∞
- –°—Ç–∞—Ç—É—Å (–∑–∞–ø—É—â–µ–Ω/–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
- –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ PID —Ñ–∞–π–ª–∞
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (–µ—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω psutil)

### 3. –û—Å—Ç–∞–Ω–æ–≤–∫–∞ daemon
```bash
python3 start.py --stop
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
- ‚úÖ –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è SIGTERM —Å–∏–≥–Ω–∞–ª –ø—Ä–æ—Ü–µ—Å—Å—É
- ‚úÖ –û–∂–∏–¥–∞–µ—Ç—Å—è graceful shutdown (–¥–æ 10 —Å–µ–∫—É–Ω–¥)
- ‚úÖ –ï—Å–ª–∏ –Ω–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è - –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è SIGKILL
- ‚úÖ –£–¥–∞–ª—è–µ—Ç—Å—è PID —Ñ–∞–π–ª

## üîß –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–æ–º

### PID —Ñ–∞–π–ª
Daemon —Å–æ–∑–¥–∞–µ—Ç —Ñ–∞–π–ª `telegram-bot-manager.pid` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:
```bash
# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å PID
cat telegram-bot-manager.pid

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–ø—É—â–µ–Ω
ps -p $(cat telegram-bot-manager.pid)
```

### Signal handling
Daemon –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–∏–≥–Ω–∞–ª—ã:
- `SIGTERM` - graceful shutdown
- `SIGINT` - graceful shutdown  
- `SIGKILL` - –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ (–Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

### –õ–æ–≥–∏
–í daemon —Ä–µ–∂–∏–º–µ –ª–æ–≥–∏ –Ω–µ –≤—ã–≤–æ–¥—è—Ç—Å—è –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª. –î–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:
```bash
# –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤ —Ñ–∞–π–ª –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
python3 start.py --daemon 2>&1 | tee daemon.log

# –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ systemd –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
./service-install.sh
./service-manager.sh logs
```

## üö¶ –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ë—ã—Å—Ç—Ä–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
# –ó–∞–ø—É—Å–∫
python3 start.py --daemon
# ‚úÖ Daemon started successfully! PID: 12345

# –ü—Ä–æ–≤–µ—Ä–∫–∞ 
python3 start.py --status  
# ‚úÖ Daemon is running (PID: 12345)

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞
python3 start.py --stop
# ‚úÖ Daemon stopped successfully
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã –ø–æ—Å–ª–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è SSH
```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
python3 start.py --daemon
python3 start.py --status

# –û—Ç–∫–ª—é—á–∞–µ–º—Å—è –æ—Ç SSH
exit

# –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è —Å–Ω–æ–≤–∞
ssh user@server
cd /path/to/project

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ daemon –≤—Å–µ –µ—â–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
python3 start.py --status
# ‚úÖ Daemon is running (PID: 12345)

# –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–æ—Å—Ç—É–ø–µ–Ω
curl http://localhost:5000
```

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### 1. Daemon –æ—Ç–∫–ª—é—á–∞–µ—Ç—Å—è –æ—Ç —Ç–µ—Ä–º–∏–Ω–∞–ª–∞
–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ daemon –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç–∫–ª—é—á–∞–µ—Ç—Å—è –æ—Ç —Ç–µ—Ä–º–∏–Ω–∞–ª–∞:
- –ù–µ—Ç –≤—ã–≤–æ–¥–∞ –≤ –∫–æ–Ω—Å–æ–ª—å
- –ù–µ —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ Ctrl+C
- –†–∞–±–æ—Ç–∞–µ—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç SSH —Å–µ—Å—Å–∏–∏

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º
```bash
python3 start.py --daemon
# ‚ö†Ô∏è Daemon is already running (PID: 12345)
# ‚ÑπÔ∏è Use 'python start.py --stop' to stop it first
```

### 3. –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ—Ä—Ç–æ–≤
Daemon –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—Ö–æ–¥–∏—Ç —Å–≤–æ–±–æ–¥–Ω—ã–π –ø–æ—Ä—Ç:
```bash
python3 start.py --daemon
# ‚ÑπÔ∏è Daemon will start in background
# üåê Web Interface will be available at: http://127.0.0.1:5001
# ‚ö†Ô∏è Port 5000 is busy, using port 5001
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### PID —Ñ–∞–π–ª –∑–∞—â–∏—Ç–∞
- PID —Ñ–∞–π–ª —Å–æ–∑–¥–∞–µ—Ç—Å—è —Å –ø—Ä–∞–≤–∞–º–∏ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ stale PID —Ñ–∞–π–ª–æ–≤  
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –ø—Ä–æ—Ü–µ—Å—Å –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –∑–∞–ø—É—â–µ–Ω

### Signal handling
- Graceful shutdown –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ SIGTERM
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏
- –ó–∞—â–∏—Ç–∞ –æ—Ç zombie –ø—Ä–æ—Ü–µ—Å—Å–æ–≤

## üÜò –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### Daemon –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –Ω–µ—Ç –¥—Ä—É–≥–æ–≥–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞
python3 start.py --status

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –µ—Å–ª–∏ –∑–∞–ø—É—â–µ–Ω
python3 start.py --stop

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∑–∞–Ω–æ–≤–æ
python3 start.py --daemon
```

### PID —Ñ–∞–π–ª –æ—Å—Ç–∞–ª—Å—è –ø–æ—Å–ª–µ —Å–±–æ—è
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –ø—Ä–æ—Ü–µ—Å—Å –Ω–µ –∑–∞–ø—É—â–µ–Ω
ps -p $(cat telegram-bot-manager.pid)

# –ï—Å–ª–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞ –Ω–µ—Ç - —É–¥–∞–ª–∏—Ç–µ PID —Ñ–∞–π–ª
rm telegram-bot-manager.pid

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∑–∞–Ω–æ–≤–æ
python3 start.py --daemon
```

### –ù—É–∂–Ω—ã –ø–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏
–î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å systemd:
```bash
./service-install.sh
./service-manager.sh start
./service-manager.sh logs  # –ñ–∏–≤—ã–µ –ª–æ–≥–∏
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ë–∞–∑–æ–≤—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
```bash
# –°—Ç–∞—Ç—É—Å –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
watch -n 10 'python3 start.py --status'

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —á–µ—Ä–µ–∑ htop
htop -p $(cat telegram-bot-manager.pid)
```

### –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (—Ç—Ä–µ–±—É–µ—Ç psutil)
```bash
pip install psutil
python3 start.py --status
# ‚úÖ Daemon is running (PID: 12345)
# ‚ÑπÔ∏è CPU: 1.2%
# ‚ÑπÔ∏è Memory: 45.3 MB  
# ‚ÑπÔ∏è Started: 1693123456.789
```

## üöÄ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

Daemon —Ä–µ–∂–∏–º –∏–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è:
- **–ë—ã—Å—Ç—Ä–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è** –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω —Å–µ—Ä–≤–µ—Ä–∞—Ö
- **–í—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è** –±–µ–∑ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ systemd
- **–†–∞–∑—Ä–∞–±–æ—Ç–∫–∏** –∫–æ–≥–¥–∞ –Ω—É–∂–µ–Ω —Ñ–æ–Ω–æ–≤—ã–π —Ä–µ–∂–∏–º
- **–ü—Ä–æ—Å—Ç–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è** –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π

–î–ª—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ –ø—Ä–æ–¥–∞–∫—à–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è systemd —Å–µ—Ä–≤–∏—Å —Å –ø–æ–ª–Ω—ã–º –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º –∏ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–æ–º.

**üéØ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `python3 start.py --daemon` –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –±—ã—Å—Ç—Ä–æ –∏ –ø—Ä–æ—Å—Ç–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–µ–∫—Ç –≤ —Ñ–æ–Ω–µ!**
