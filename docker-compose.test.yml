# Docker Compose Ð´Ð»Ñ Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ Ñ€Ð°Ð·Ð²ÐµÑ€Ñ‚Ñ‹Ð²Ð°Ð½Ð¸Ñ
version: '3.8'

services:
  # Ð¢ÐµÑÑ‚ Ñ€Ð°Ð·Ð²ÐµÑ€Ñ‚Ñ‹Ð²Ð°Ð½Ð¸Ñ Ð½Ð° Ubuntu 22.04
  ubuntu-test:
    build: .
    container_name: telegram-bot-manager-ubuntu-test
    volumes:
      - ./logs:/home/testuser/telegram-bot-manager/logs
      - ./test-results:/home/testuser/test-results
    environment:
      - TEST_MODE=1
      - PYTHONPATH=/home/testuser/telegram-bot-manager
    networks:
      - test-network

  # Ð¢ÐµÑÑ‚ ÐºÐ»Ð¾Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ Ð¸Ð· GitHub (Ð¸Ð¼Ð¸Ñ‚Ð°Ñ†Ð¸Ñ Ð¿Ñ€Ð¾Ð´Ð°ÐºÑˆÐµÐ½Ð°)
  github-clone-test:
    image: ubuntu:22.04
    container_name: telegram-bot-manager-github-test
    environment:
      - DEBIAN_FRONTEND=noninteractive
    volumes:
      - ./test-results:/test-results
    command: >
      bash -c "
        echo 'ðŸŒ Ð¢Ð•Ð¡Ð¢ ÐšÐ›ÐžÐÐ˜Ð ÐžÐ’ÐÐÐ˜Ð¯ Ð˜Ð— GITHUB' &&
        apt-get update && 
        apt-get install -y python3 python3-pip python3-venv git curl &&
        cd /tmp &&
        echo 'ðŸ“¥ ÐšÐ»Ð¾Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ð¸Ñ...' &&
        git clone https://github.com/ElectroNickP/Telegram-Bot-Manager.git &&
        cd Telegram-Bot-Manager &&
        echo 'ðŸ”„ ÐŸÐµÑ€ÐµÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ð½Ð° Ð²ÐµÑ‚ÐºÑƒ prod-test...' &&
        git checkout prod-test &&
        echo 'ðŸ“‹ ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ñ„Ð°Ð¹Ð»Ð¾Ð²...' &&
        ls -la &&
        echo 'ðŸ§ª Ð—Ð°Ð¿ÑƒÑÐº Ñ‚ÐµÑÑ‚Ð¾Ð²...' &&
        python3 deploy-test.py &&
        echo 'âœ… GITHUB CLONE TEST COMPLETED' > /test-results/github-test.log
      "
    networks:
      - test-network

networks:
  test-network:
    driver: bridge

volumes:
  test-results:

